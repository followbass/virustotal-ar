<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>VirusTotal - فحص الروابط والملفات</title>
  <style>
    body {
      font-family: "Arial", sans-serif;
      background: #f0f0f0;
      padding: 20px;
      text-align: center;
    }
    .container {
      background: #fff;
      border-radius: 10px;
      padding: 30px;
      max-width: 600px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    input[type="text"], input[type="file"] {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      padding: 10px 20px;
      margin: 10px;
      border: none;
      background-color: #3498db;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background-color: #2980b9;
    }
    .result {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
    }
    .result.clean {
      color: green;
    }
    .result.malicious {
      color: red;
    }
    table {
      margin: 20px auto;
      border-collapse: collapse;
      width: 100%;
      direction: rtl;
    }
    th, td {
      padding: 8px 12px;
      border: 1px solid #ddd;
    }
    th {
      background-color: #eee;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>فحص الروابط والملفات - VirusTotal</h2>

    <input type="text" id="url" placeholder="أدخل الرابط هنا">
    <button onclick="scanUrl()">فحص الرابط</button>

    <hr>

    <input type="file" id="fileInput">
    <button onclick="scanFile()">فحص الملف</button>

    <div id="output" class="result"></div>
    <div id="details"></div>
  </div>

  <script>
    async function scanUrl() {
      const url = document.getElementById('url').value;
      if (!url) return alert("يرجى إدخال رابط.");

      const res = await fetch('/scan-url', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url })
      });

      const data = await res.json();
      displayResult(data);
    }

    async function scanFile() {
      const fileInput = document.getElementById('fileInput');
      if (!fileInput.files.length) return alert("يرجى اختيار ملف.");

      const formData = new FormData();
      formData.append('file', fileInput.files[0]);

      const res = await fetch('/scan-file', {
        method: 'POST',
        body: formData
      });

      const data = await res.json();
      displayResult(data);
    }

    function displayResult(data) {
      const output = document.getElementById('output');
      const details = document.getElementById('details');

      if (data.error) {
        output.textContent = data.error;
        output.className = 'result';
        details.innerHTML = '';
        return;
      }

      output.textContent = data.النتيجة;
      output.className = 'result ' + (data.النتيجة.includes('ضار') ? 'malicious' : 'clean');

      if (Array.isArray(data.التفاصيل)) {
        const rows = data.التفاصيل.map(item =>
          `<tr><td>${item.المحرك}</td><td>${item.النتيجة}</td></tr>`).join('');
        details.innerHTML = `
          <table>
            <thead>
              <tr><th>المحرك</th><th>النتيجة</th></tr>
            </thead>
            <tbody>${rows}</tbody>
          </table>
        `;
      } else {
        details.innerHTML = `<p>${data.التفاصيل}</p>`;
      }
    }
  </script>
</body>
</html>
